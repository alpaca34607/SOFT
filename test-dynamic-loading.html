<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動態載入測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .product-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .success {
            color: #28a745;
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
        }
        
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>動態載入測試</h1>
    
    <div class="test-section">
        <h2>測試前台動態載入後台資料</h2>
        <button onclick="testLoadProducts()">載入商品資料</button>
        <button onclick="testLoadSingleProduct()">載入單一商品</button>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>測試顏色選項</h2>
        <div id="colorTest">
            <p>載入商品資料後，這裡會顯示顏色選項測試</p>
        </div>
    </div>
    
    <script>
        // 模擬前台的 loadProductsConfig 函數
        async function loadProductsConfig() {
            try {
                const response = await fetch('/api/products');
                const data = await response.json();
                
                // 將後台資料轉換為前台格式
                const PRODUCTS_CONFIG = {};
                data.products.forEach(product => {
                    PRODUCTS_CONFIG[product.product_id] = {
                        name: product.name,
                        price: product.price,
                        deposit: product.deposit,
                        maxQuantity: product.max_quantity,
                        mainColors: product.main_colors || [],
                        subColors: product.sub_colors || []
                    };
                });
                
                console.log('已載入商品配置:', PRODUCTS_CONFIG);
                return PRODUCTS_CONFIG;
                
            } catch (error) {
                console.error('載入商品配置失敗:', error);
                throw error;
            }
        }
        
        // 測試載入所有商品
        async function testLoadProducts() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>載入中...</p>';
            
            try {
                const products = await loadProductsConfig();
                
                let html = '<div class="success">✅ 成功載入商品資料</div>';
                html += '<h3>商品列表:</h3>';
                
                Object.keys(products).forEach(productId => {
                    const product = products[productId];
                    html += `
                        <div class="product-item">
                            <h4>${product.name}</h4>
                            <p>商品ID: ${productId}</p>
                            <p>價格: NT$ ${product.price}</p>
                            <p>訂金: NT$ ${product.deposit}</p>
                            <p>最大數量: ${product.maxQuantity}</p>
                            <p>主色選項: ${product.mainColors.join(', ') || '無'}</p>
                            <p>副色選項: ${product.subColors.join(', ') || '無'}</p>
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
                
                // 更新顏色測試區域
                updateColorTest(products);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">❌ 載入失敗: ${error.message}</div>`;
            }
        }
        
        // 測試載入單一商品
        async function testLoadSingleProduct() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>載入中...</p>';
            
            try {
                const response = await fetch('/api/products/product-Softzilla');
                const data = await response.json();
                
                if (data.product) {
                    const product = data.product;
                    resultsDiv.innerHTML = `
                        <div class="success">✅ 成功載入單一商品</div>
                        <div class="product-item">
                            <h4>${product.name}</h4>
                            <p>商品ID: ${product.product_id}</p>
                            <p>價格: NT$ ${product.price}</p>
                            <p>訂金: NT$ ${product.deposit}</p>
                            <p>最大數量: ${product.max_quantity}</p>
                            <p>主色選項: ${(product.main_colors || []).join(', ') || '無'}</p>
                            <p>副色選項: ${(product.sub_colors || []).join(', ') || '無'}</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = '<div class="error">❌ 找不到商品</div>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">❌ 載入失敗: ${error.message}</div>`;
            }
        }
        
        // 更新顏色測試區域
        function updateColorTest(products) {
            const colorTestDiv = document.getElementById('colorTest');
            
            if (Object.keys(products).length === 0) {
                colorTestDiv.innerHTML = '<p>沒有商品資料</p>';
                return;
            }
            
            const firstProduct = Object.values(products)[0];
            const colorNames = {
                'black': '黑色',
                'white': '白色',
                'gray': '灰色',
                'gold': '金色',
                'silver': '銀色',
                'bronze': '銅色',
                'red': '紅色',
                'orange': '橙色',
                'yellow': '黃色',
                'blue': '藍色',
                'green': '綠色',
                'brown': '棕色',
                'none': '無顏色選項'
            };
            
            let html = '<h3>顏色選項測試 (以第一個商品為例):</h3>';
            html += `<p><strong>商品:</strong> ${firstProduct.name}</p>`;
            
            // 主色選項
            html += '<h4>主色選項:</h4>';
            if (firstProduct.mainColors.length > 0) {
                html += '<ul>';
                firstProduct.mainColors.forEach(color => {
                    html += `<li>${color} (${colorNames[color] || color})</li>`;
                });
                html += '</ul>';
            } else {
                html += '<p>無主色選項</p>';
            }
            
            // 副色選項
            html += '<h4>副色選項:</h4>';
            if (firstProduct.subColors.length > 0) {
                html += '<ul>';
                firstProduct.subColors.forEach(color => {
                    html += `<li>${color} (${colorNames[color] || color})</li>`;
                });
                html += '</ul>';
            } else {
                html += '<p>無副色選項</p>';
            }
            
            colorTestDiv.innerHTML = html;
        }
        
        // 頁面載入時自動測試
        window.addEventListener('load', () => {
            console.log('頁面載入完成，可以開始測試');
        });
    </script>
</body>
</html> 